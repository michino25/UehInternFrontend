@page "/LoginCallback/"
@layout EmptyLayout

@using Microsoft.AspNetCore.WebUtilities
@using global::Login.ST.UEH

@code {
    public string? api;
    protected override void OnInitialized()
    {
        api = Configuration["apiBackend"];
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        var uri = new Uri(NavigationManager.Uri);
        var queryParameters = QueryHelpers.ParseQuery(uri.Query);
        var t = queryParameters["t"];
        UserLogin? user;

        switch (t) {
            case "exist-admin":
                NavigationManager.NavigateTo("/tongquan");
                break;

            case "exist-teacher":
                NavigationManager.NavigateTo("/sinhvien");
                break;

            case "exist-student":
                NavigationManager.NavigateTo("/thongtin");
                break;
            
            case "admin":

                user = new UserLogin
                {
                    UserId = "000688",
                    Name = "Phan Hiền",
                    Email = "hienphan@ueh.edu.vn",
                    Sdt = "0909259404",
                    Role = "teacher"
                };

                await Service.LoginRequest(JS, NavigationManager, api, user, "/tongquan");
                break;

            case "gv":

                user = new UserLogin
                {
                    UserId = "001747",
                    Name = "Đặng Thái Thịnh",
                    Email = "thinhdt@ueh.edu.vn",
                    Sdt = "0905553609",
                    Role = "teacher"
                };

                await Service.LoginRequest(JS, NavigationManager, api, user, "/sinhvien");
                break;

            default:

                var obj = LoginStUEH.GetInfo(t);
                if (obj != null)
                {
                    Student stu = (Student) obj;
                    user = (UserLogin) stu;

                    await Service.LoginRequest(JS, NavigationManager, api, user, "/thongtin");
                }
                break;

        }

    }
}
